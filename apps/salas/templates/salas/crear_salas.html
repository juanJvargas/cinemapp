{% extends 'base.html' %}
{% load staticfiles %}
{% load bootstrap3 %}
{% load mathfilters %}

{% block titulo %}Gesti√≥n de Salas{% endblock titulo %}
{% block descripcion_pagina %} Gestiona las salas CINEMAPP {% endblock descripcion_pagina %}
{% block miga_pan %}
    <li><a href="{% url 'accounts:home'%}"><i class="fa fa-dashboard"></i> DASHBOARD</a></li>
    <li class="active">GESTIONAR SALAS</li>
{% endblock miga_pan %}

{% block css %}
    <link rel="stylesheet" href="{%  static 'bower_components/datatables.net-bs/css/dataTables.bootstrap.min.css' %}">
    <link href="{% static 'bower_components/datatables.net-bs/responsive/responsive.dataTables.min.css' %}" rel="stylesheet">
    {{ form.media.css }}
    <style media="screen">
        .select2-container {
            width: 100% !important;
            height: 100% !important;
        }

        .rectangulo {
            background-color: black;
            width: 250px;
            margin: 10px;
            margin-left: auto;
            margin-right: auto;

        }

        .flex-container {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .flex-container > div {
            background-color: white;
            color: white;
            width: 18px;
            margin: 0px;
            text-align: center;
            line-height: 13px;
        }

        input[type='checkbox'] {
            content: '';
            display: inline-block;
            -webkit-appearance: none;
            -moz-appearance: none;
            margin:0;
            width: 16px;
            height: 16px;

        }
        input[type='checkbox']:checked {
            text-align: center;
        }
        input[type=checkbox]:hover {
            filter: brightness(10%);

        }
        input[type='radio'] {
            content: '';
            display: inline-block;
            -webkit-appearance: none;
            -moz-appearance: none;
            margin-left: 5px;
            width: 16px;
            height: 16px;
        }
        input[type='radio']:checked {
            text-align: center;
        }
        input[type=radio]:hover {
            filter: brightness(10%);

        }

        .SIN_MARCAR{
            background: rgb(223, 214, 223);
        }

        .PREFERENCIAL {
            background: rgb(255, 91, 185 );
        }

        .GENERAL {
            background: rgb(24, 215, 79);
        }

        .DISCAPACITADO {
            background: rgb(0, 185, 240);
        }


    </style>
{% endblock css %}

{% block contenido %}

    <div class="col-md-6">
        <div class="box">
            <div class="box-header with-border">
                <h3 class="box-title">Registrar Sala</h3>
            </div>
            <div class="box-body">

                <form method="post" action="{% url 'salas:crear' %}" enctype="multipart/form-data"> {% csrf_token %}
                    <div class="row">
                        <div class="col-sm-4 col-md-offset-3">
                            {% bootstrap_field form.tipo_sala %}
                        </div>
                        <div class="col-sm-2">
                            {% bootstrap_field form.num_sala %}
                        </div>
	                    {% if user.is_staff %}
                        <div class="col-sm-2">
                            {% bootstrap_field form.sucursal %}
                        </div>
	                    {% else %}
		                    <div class="col-sm-2 hidden">
                            {% bootstrap_field form.sucursal %}
                        </div>
	                    {% endif %}
                    </div>

                    <div class="rectangulo">
                        <center>
                            <font color="white" size="5">Pantalla</font></center>
                    </div>

                    <div style='text-align:center'>
                        <input type="radio" class="PREFERENCIAL" id="p" name="drone" value="Preferencial">
                        <label for="p">Preferencial</label>

                        <input type="radio"  class="GENERAL" id="g" name="drone" value="General">
                        <label for="g">General </label>

                        <input type="radio"  class="DISCAPACITADO" id="d" name="drone" value="Discapacitados" >
                        <label for="d">Discapacitado </label>
                        <input type="radio"  class="SIN_MARCAR" id="s" name="drone" value="Sin_marcar" >
                        <label for="s">Sin marcar</label>
                    </div>
                    {% for i in itemlist %}

                        <div class="flex-container">
                            {% for j in itemlist %}

                                <div >

                                    <input id="{{i}}-{{j}}" class="SIN_MARCAR" onclick="myFunction(this)" type="checkbox" name="silla" value='{"i":{{i}},"j":{{j}},"color": "SIN_MARCAR"}'>

                                </div>

                            {% endfor %}

                        </div>

                    {% endfor %}
                    <div  class="row">
                        <div class="col-sm-3 col-sm-offset-1">
                            {% bootstrap_field form.is_active%}
                        </div>
                    </div>
                    <button style="margin-left: 75%" type="submit" class="btn btn-success btn-raised">Registrar</button>
                </form>

            </div>
        </div>
    </div>


    <div class="col-md-6">
        <div class="box">
            <div class="box-header with-border">
                <h3 class="box-title">Listado de salas</h3>
            </div>
            <div class="box-body">
                <table id="tabla_salas" class="table table-striped table-bordered table-responsive">
                    <thead>
                    <tr>
                        <th>No.</th>
                        <th>Tipo sala</th>
                        <th>Sucursal</th>
                        <th>Estado</th>
                        <th>Acciones</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for sala in salas %}
                        <tr>
                            <td>{{ sala.num_sala}}</td>
                            <td>{{ sala.tipo_sala}}</td>

                            <td>{{ sala.sucursal }}</td>
                            <td>
                                {%  if sala.is_active %} <span class="badge bg-green">Activo</span>
                                {% else %} <span class="badge bg-red">Inactivo</span>
                                {% endif %}
                            </td>
                            <td>
                                <div class="btn-group">
                                    <button type="button" class="btn btn-info btn-sm dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
                                        <span class="caret"></span>
                                        <div class="ripple-container"></div>Opciones</button>
                                    <ul class="dropdown-menu">
                                        <li><a href="{% url 'salas:editar_sala' sala.id %}">Editar sala</a></li>
                                        <li><a class="dropdown-item" href="{% url 'salas:ver_sala' sala.id %}">Ver sala</a></li>
                                    </ul>
                                </div>

                            </td>
                        </tr>
                    {% endfor %}

                    </tbody>
                </table>

            </div>
        </div>
    </div>



{% endblock contenido %}


{% block js %}

    <script src="{% static 'bower_components/datatables.net/js/jquery.dataTables.min.js' %}"></script>
    <script src="{% static 'bower_components/datatables.net-bs/js/dataTables.bootstrap.min.js' %}"></script>
    <script src="{% static 'bower_components/datatables.net-bs/responsive/dataTables.responsive.min.js' %}"></script>

    {{ form.media.js }}

    <script>
        $(function () {
            $('#tabla_salas').DataTable({
                    "pageLength": 10,
                    "lengthChange": false,
                    "searching": false,
                    "info": false,
                    "pagingType": "simple",
                    "language": {
                        "url": "{% static 'bower_components/datatables.net/spanish.json' %}"
                    }
                }
            )
        })
    </script>
    <script>
        var arr = Array.from(Array(26), () => new Array(26));
        for(var i=0;i<26;i++){
            for(var j=0;j<26;j++){
                arr[i][j]=document.getElementById(i+ "-"+ j);
            }
        }
        var value=0;
        var click=false;
        var i_empieza=0;
        var j_empieza=0;
        var i_termina=0;
        var j_termina=0;

        function myFunction(elemento_clickeado) {
            var preferencial = document.getElementById("p");
            var general = document.getElementById("g");
            var discapacitado = document.getElementById("d");
            var sin_marcar = document.getElementById("s");
            obj = JSON.parse(elemento_clickeado.value);

            console.log(elemento_clickeado.id)

            if (preferencial.checked == true){
                elemento_clickeado.className = "PREFERENCIAL";
                obj["color"]="PREFERENCIAL";
                elemento_clickeado.value=JSON.stringify(obj);
                elemento_clickeado.checked=true;
                var str = elemento_clickeado.id;
                var array = str.split("-",2);
                if(value==1){
                    i_termina=parseInt(array[0]);
                    j_termina=parseInt(array[1]);
                    value=0;
                    click=true;
                }else if(value==0){

                    i_empieza=parseInt(array[0]);
                    j_empieza=parseInt(array[1])
                    value=value+1;
                }

            } else if(general.checked == true) {
                elemento_clickeado.className = "GENERAL";
                obj["color"]="GENERAL";
                elemento_clickeado.value=JSON.stringify(obj);
                elemento_clickeado.checked=true;
                var str = elemento_clickeado.id;
                var array = str.split("-",2);
                if(value==1){
                    i_termina=parseInt(array[0]);
                    j_termina=parseInt(array[1]);
                    value=0;
                    click=true;
                }else if(value==0){

                    i_empieza=parseInt(array[0]);
                    j_empieza=parseInt(array[1])
                    value=value+1;
                }

            } else if (discapacitado.checked == true){
                elemento_clickeado.className = "DISCAPACITADO";
                obj["color"]="DISCAPACITADO";
                elemento_clickeado.value=JSON.stringify(obj);
                elemento_clickeado.checked=true;
                var str = elemento_clickeado.id;
                var array = str.split("-",2);
                if(value==1){
                    i_termina=parseInt(array[0]);
                    j_termina=parseInt(array[1]);
                    value=0;
                    click=true;
                }else if(value==0){
                    i_empieza=parseInt(array[0]);
                    j_empieza=parseInt(array[1])
                    value=value+1;
                }

            }else if(sin_marcar.checked == true) {
                elemento_clickeado.className = "SIN_MARCAR";
                obj["color"]="SIN_MARCAR";
                elemento_clickeado.value=JSON.stringify(obj);
                elemento_clickeado.checked=false;
                var str = elemento_clickeado.id;
                var array = str.split("-",2);
                array= parseInt(array);
                value=0;
            }else{
                elemento_clickeado.checked=false;
            }
            if(click==true){

                var aux_ie= Math.min(i_empieza,i_termina);
                console.log(aux_ie);
                var aux_it= Math.max(i_empieza,i_termina);

                var aux_je= Math.min(j_empieza,j_termina);
                var aux_jt= Math.max(j_empieza,j_termina);
                console.log(aux_ie);
                console.log(aux_je);
                console.log(aux_it);
                console.log(aux_jt);
                va_q=i_termina;
                va_s=j_termina;

                i_empieza=aux_ie;
                j_empieza= aux_je;
                i_termina=aux_it;
                j_termina=aux_jt;
                console.log(i_empieza+"ie");
                console.log(j_empieza+"je");
                console.log(i_termina+"it");
                console.log(j_termina+"jt");

                for(var i=i_empieza;i<=i_termina;i++){
                    for(var j=j_empieza;j<=j_termina;j++){

                        arr[i][j].checked=true;
                        var final= document.getElementById(va_q+ "-"+ va_s);
                        arr[i][j].className = final.className;
                        objeto = JSON.parse(arr[i][j].value);
                        objeto["color"]=  String(final.className);
                        arr[i][j].value=JSON.stringify(objeto);
                        console.log(document.getElementById(i+"-"+j))
                    }
                }
                click=false;
            }
        }
    </script>
{% endblock js %}